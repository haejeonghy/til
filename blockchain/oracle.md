# Oracle

* Web API나 마켓 데이터 피드와 같은 방식을 통해 블록체인과 스마트 컨트랙트 용 외부 데이터를 검색하고 검증하는 것
* 스마트 컨트랙트에서 요구하는 데이터 종류에는 가격 정보, 날씨 정보, 게임을 위한 난수 생성 등
* 특정 정보에 대해 데이터 자원을 쿼리하고 블록체인과 외부 데이터 간의 인터페이스를 제공하는 것으로 구성된다.
* 스마트 컨트랙트는 외부 데이터로부터 오는 특정 정보에 의해 실행될 수 있다.
* 외부에서 오는 데이터는 블록체인이나 스마트 컨트랙트처럼 결정적(deterministic)이지 않다는 점
* 외부에서 오는 비결정적인 정보를 블록체인이 이해하고 특정 조건에서 실행할 수 있도록 하는 형식으로 만들어주는 가교 역할

## 오라클 문제

* 서드 파티 오라클과 스마트 컨트랙트의 무신뢰성 실행 간 보안, 인증, 신뢰 충돌 문제에 관한 것
* 스마트 컨트랙트는 주어진 데이터에 따라 계약 이행 여부를 결정한다.
  * 데이터에 대한 자체적인 판단 능력을 가지고 있지 않다.
    * 데이터에 대한 출처나 신뢰도가 불명확할 수 있다.
    * 출처가 분명하더라도 외부 데이터를 가져오는 과정에서 해커에 의해 위변조가 일어날 수 있다.
    * 이러한 문제들로 인해 데이터 자체애 대한 신뢰성에 의문이 제기될 수 있다.
      * 난수 생성 문제 등

### 컴퓨터에서 난수 생성

* 블록체인 상에서 다양한 dApp을 만들게 되면서 난수에 대한 필요성이 높아졌다.
* 유사 난수
  * pseudo random
  * 컴퓨터에 있는 데이터와 알고리즘을 통해 얻게 되는 난수
  * 컴퓨터 내부에 있는 알고리즘과 데이터를 가지고 생성되었기 때문에 특정한 패턴을 가지게 되고 예측할 수 있다.
* 진짜 난수
  * true random
  * 외부로부터 불확실성을 가져와 생성된 난수
  * 외부 소음을 가져와 디지털화 하여 난수를 생성하면 무작위성을 확보할 수 있다.
  * 조작할 수 없고, 예측할 수 없다.

### 블록체인에서의 난수 생성 문제 

* 물리 현상 가져오기
  * 소음과 같은 외부의 값을 가져와서 무작위성을 확보할 수 있다.
  * 블록체인에서는 난수를 생성하는 과정에서 노드가 자신에게 유리한 값이 나올 때까지 물리 현상을 관측하고 유리한 값이 나오면 그 값을 스마트 컨트랙트에 사용할 수 있다.
    * 사용자가 고의적으로 난수 생성을 조작하는 것과 같다.
* 여러 사용자가 가져온 값을 사용하기
  * 여러 사용자 중 악의적인 사용자가 다른 사용자들의 값을 참고하여 자신에게 유리한 값이 나오는 값을 보내 난수 생성을 조작할 수도 있다.
* 블록체인 내부의 값 사용하기
  * 블록체인에 사용되는 블록 해시 값을 사용할 수 있다.
  * 이전 블록의 해시 값을 참조하기 때문에 블록을 생성하는 채굴 노드가 자신에게 유리한 블록 해시 값이 나올 때까지 해시 값을 조작할 수 있다.
* 블록체인에서 모든 노드들이 트랜잭션을 검증함으로써 데이터의 무결성을 보장하기 때문에 블록체인에서 일어나는 모든 동작은 결정적인 방식으로 일어난다.
* 블록체인에서 조작하거나 예측할 수 없는 진짜 난수를 만들 때는 이 난수값이 정말로 조작되지 않았는지 증명할 수 있어야 한다.

#### 블록체인에서 난수 생성하기

* commit reveal scheme
  * 기존의 여러 사용자가 가져온 값을 사용하는 경우 개선
  * 스마트 컨트랙트를 사용하면 서로의 값을 모른 채로 값을 제출할 수 있다.
  1. commit stage에서는 자신이 보내려는 값을 암호화하고 일정 금액의 토큰고 ㅏ함께 스마트 컨트랙트에 보낸다.
     1. 토큰은 예치금의 역할을 한다.
  2. 일정 기간이 지나면 참여자들은 자신이 제출하려고 했던 원래 값을 스마트 컨트랙트에게 보낸다.
  3. 스마트 컨트랙트는 사용자가 보낸 원래 값을 암호화하여 이전에 보낸 암호화 된 값과 비교한다.
     1. 다른 값을 보냈다면 이 유효성 검사를 통과하지 못하게 된다.
     2. 올바른 값을 보냈다면 토큰을 돌려준다.
  4. 스마트 컨트랙트는 주어진 값을 사용해 난수를 생성한다.
  * commit reveal scheme을 사용하면 서로가 어떤 값을 보낸다.
    * 난수 값을 예상하거나 난수 생성을 조작할 수 없다.
    * 유효성 검사 과정을 통해 난수 값을 조작할 수 없다는 것을 증명할 수 있다.
* BLS Scheme
  * 임계값 서명의 종류
  * N명의 사용자가 개인키 S를 쪼개어 가지고 있다가 난수를 생성해야 할 때 참여자들이 각각 자신이 가지고 있는 개인키 조각을 제출한다.
    * 개인키를 k명 이상이 제출하면 k개의 개인키 조각을 가지고 난수를 생성한다.
  * k명의 사람이 정직하면 난수를 생성할 수 있다. 