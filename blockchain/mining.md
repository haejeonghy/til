# Mining

* 채굴
* 블록체인 네트워크에 노드로 트랜잭션을 검증하여 분산 원장을 기록하고 보상으로 암호 화폐를 얻는 것
* 새로운 블록을 만드는 것이 채굴의 핵심
* 특정 컴퓨터 연산을 통해 만들어진다.
* 비트코인
  * 10분에 한 번씩 일정량의 블록이 생성된다.
  * 생성된 비트코인을 채굴에 참여한 작업자 중 해시퍼즐이라는 문제를 푼 작업자에게 지급한다.
  * 해시퍼즐
    * 특정한 조건을 갖춘 해시를 찾아내는 일련의 과정
* 채굴자 
  * 블록체인 기반 암호화폐에서 새로운 블록을 생성하고 그 대가로 암호화폐를 지급받는 노드
  * 채굴을 통해 이익을 얻는다.

## Token Economy

* 토큰 이코노미
* 어떤 행동에 대해 토큰을 보상함으로써 특정 행동을 유도하는 경제 생태계
* 보상으로 주어지는 토큰은 다른 유형의 물건이나 다른 서비스와 교환할 수 있는 지역 화폐
* 블록체인 분야에서는 토큰을 활용해 생태계에서 목표로 하는 행동을 유도하는 시스템으로 사용
* 비트코인
  * 채굴자들이 경쟁하게 만들어낼 수 있도록 한다.
* 토큰의 가치는 토큰 이코노미를 어떻게 설계하느냐에 따라 달라진다.
  * SNS dApp (decentralized application) 스팀잇
    * 암호화폐 중 하나인 steem 스팀 블록체인에 기반하여 운영되는 블록체인 기반 sns 시스템
    * 검열없는 sns를 추구하는 분산화된 서비스
    * 다양한 주제로 컨텐츠를 올리고 커뮤니케이션 할 수 있다.
    * 블록체인 기반 블로깅 소셜 네트워크
    * 콘텐츠를 올리는 사용자들에게 토큰으로 보상을 준다.
* 블록체인 + 토큰 이코노미
  * 발생하는 이익을 다수가 나눈다.
  * 자신의 토큰이 속해있는 네트워크가 커질수록 토큰의 가치 또한 커지기 때문에 적극적으로 서비스에 참여한다.

## Crypto Economy

* 크립토 이코노미
* 수년간 블록체인 발전을 통해 형성된 새로운 경제 모델
* 경제 생태계 
  * 블록체인에서 사용하는 코인 또는 토큰을 활용하여 서비스를 제공하여 이윤을 창출하는 방법
  * 참여자들에게 보상을 주어 활성화하는 방법
  * 분산원장의 거버넌스 등을 결합
* 토큰 이코노미가 크립토 이코노미를 구성하는 중요한 일부분이다.
* 블록체인의 마이닝 코인을 기반으로 한 토큰 이코노미 
* 하나의 생태계는 생태계를 대표하는 거버넌스 코인(토큰)이 있다.
  * 테라 생태계 거버넌스 코인 : $Luna
  * 이더리움 생태계 거버넌스 코인 : $ETH
  * 클레이튼 생태계 거버넌스 코인 : $KLAY
  
### 크립토 이코노미 생태계

  * 암호화폐는 블록체인으로 공급된 통화이다.
  * 암호화된 자산은 재화에 해당한다.
  * 사용자들에 대한 보상은 기본 소득의 성격을 갖는다.
  * 플랫폼 운영자는 탈중앙화 된 방식으로 모아야 한다.
    * 최소한 운영 비용은 제공해야 한다.
    * 경제인으로서의 이익은 가져가야 한다.
    * 탈중앙화된 방식으로 누구나 참여할 수 있다면 보상의 규모는 현재 플랫폼 사업자가 얻는 수준의 초과 이익보다 적을 것이다.
  * 스마트 콘트랙트는 사용자가 다양한 재화와 용역을 암호화폐를 지불하면서 직거래 할 수 있도록 한다. 
  * 암호화폐와 스마트 콘트랙트를 통해 플랫폼은 사업자 없이 P2P 거래를 수행한다.
  * 신뢰, 평판, 보안을 얻는 것은 암호학을 바탕으로 보장되어야 한다.
  * 거버넌스는 탈중앙호된 형태로 구조화되어야 한다. 
  * 합의 알고리즘은 거버넌스를 뒷받침한다.
  * 합의 알고리즘은 토큰 이코노미나 보상 체계와도 연관된다.
  * 크립토 이코노믹스는 토큰 이코노미와 보상체계, 암호화 기술, 거버넌스 등을 모두 포괄한다.

## 코인과 토큰의 차이

* 코인
  * 블록체인 네트워크에 채굴자로 참여한 노드에게 분배된다.
  * 채굴에 대한 보상으로 주어지는 암호화폐를 의미한다.
  * 암호화폐는 해당 블록체인 네트워크를 나타내는 이름으로도 사용된다.
    * 이더리움 네트워크에서 채굴자 보상으로 주어지는 암호화폐는 이더리움이다.
  * 블록체인 네트워크의 특성에 따라 투표를 위한 권리를 증명하기도 한다.
    * 지분증명, 위임지분증명을 통해 채굴하는 블록체인 네트워크의 경우
* 토큰
  * 블록체인 네트워크 위에서 발행된 지역화폐
  * 발행된 블록체인 네트워크 내에서만 사용될 수 있다.
  * 코인처럼 새로운 생태계를 만들어낼 수 있다.
    * De-Fi 탈중앙화 금융의 경우
    * 하나의 토큰을 거버넌스 토큰으로 정하고 이 거버넌스 토큰을 중심으로 새로운 생태계를 구성한다.
    * 생태계 내에서 발행한 토큰을 자산으로 취급하며 거버넌스 토큰과 소통하며 생태계를 구성한다.
    * De-Fi에서는 거버넌스 토큰을 예치(staking 스테이킹) 한다.
    * 토큰과 코인 또는 토큰과 토큰 사이의 거래 수수료를 예치한 사람들에게 재분배하는 모델을 사용하기도 한다.
      * 토큰 이코노미
        * 토큰을 기반으로 새롭게 생성된 생태계
        * 토큰 이코노미 다수가 모여 crypto economy를 실현한다.

## 채굴자가 하는 일

* 채굴은 블록체인 네트워크를 유지하면서 개인에게는 이익을 준다.
* 네트워크 동기화
  * 새 노드가 비트코인 네트워크에 합류하면 다른 노드에게 과거의 블록들을 요청해 블록체인을 다운로드 한다. 
* 트랜잭션 검증
  * 새로운 트랜잭션을 수신한 노드는 반드시 해당 트랜잭션이 올바른 트랜잭션인지 검증하는 과정이 필요하다.
  * 검증하는 단계
    1. 원본 데이터를 자신의 개인키로 암호화하여 디지털 서명을 진행한다.
    2. 원본 데이터와 디지털 서명된 데이터를 노드에 전파한다.
    3. 트랜잭션을 받은 노드는 해당 트랜잭션이 진짜인지 검증하기 위해 트랜잭션을 송신한 노드의 공개키를 이용하여 난독화를 진행한다.
    4. 난독화된 거래 데이터와 원본 데이터를 비교하여 수정된 데이터가 있는지 확인해 데이터의 무결성을 검증한다.
    5. 수신받은 트랜잭션이 진짜 거래로 판단될 경우 블록체인에 해당 트랜잭션을 업데이트 하고 블록체인 네트워크에 연결된 노드들에게 해당 트랜잭션을 전파한다.
* 블록 유효성 검사
  * 채굴자와 풀 노드는 특정 규칙에 따라 수신한 블록을 평가하여 유효성 검사를 시작한다.
* 새로운 블록 생성
  * 채굴자는 네트워크에 브로드캐스팅된 트랜잭션의 유효성을 검사한다.
* 작업 증명 (PoW) 수행
  * 채굴 과정의 핵심
  * 채굴자가 해시 퍼즐을 풀어 유효한 블록을 찾는다.
  * 블록 헤더에 있는 nonce 논스를 사용하여 채굴자는 논스 값을 바꿔가며 해시 값이 미리 결정된 목표 값보다 작을 때까지 반복 계산한다.
    * 블록 헤더에 있는 nonce
      * 입력값 중 하나
      * 계산되는 블록 해시값이 특정 숫자보다 작아지게 하는 값
    * 이더리움 트랜잭션 nonce 
      * 발신 주소의 속성
      * 발신 주소의 컨텍스 안에서만 의미를 갖는다.
      * 명시적으로 블록체인 계정 상태에 저장되지 않는다.
      * 해당 주소에서 발생한 확인된 트랜잭션 건수를 세어서 동적으로 계산되는 값으로 쓰인다.
* 보상 수령
  * 해시 퍼즐의 해를 구한 노드는 즉시 결과를 브로드캐스팅한다.
  * 다른 노드들은 그 결과를 검증하여 그 블록을 승인한다.
  * 승인되면 채굴자는 비트코인과 관련된 트랜잭션 수수료를 보상으로 받는다.

## 이더리움 채굴

* 네트워크 채굴 누드는 이더해시 (ethash)라는 독자적인 작업 증명 알고리즘을 사용해 블록을 생성하고자 경쟁한다.
* 이더해시 알고리즘에 대한 입력은 논스라는 임의로 생성된 숫자를 포함하는 블록 헤더이다.
* 그 출력은 32바이트의 16진수이다.
* 논스를 수정하면 출력도 수정되는데 예측할 수 없는 방식으로 수정된다.
* 네트워크가 채굴된 블록을 수용하려면 블록 헤더에 대한 이더해시 출력이 네트워크 난이도보다 적어야 하고, 또 다른 32바이트의 16진수가 채워질 대상으로 사용되며 목표 난이도를 상회하는 블록을 브로드캐스트하는 모든 채굴자는 블록 보상을 받게 된다.

## 보상

* 해시 퍼즐의 해를 구한 노드는 즉시 결과를 브로드캐스팅하고, 다른 노드들은 결과를 검증하여 블록을 승인한다.
* 블록이 승인되면 채굴자는 비트코인과 관련된 트랜잭션 수수료를 보상으로 받는다.
* 비트코인의 작업증명의 해를 구하는 시간으로 10분이 소요되도록 알고리즘이 형성되어있기 때문에, 더 많은 채굴자들이 등장하고 빨리 채굴할 수록 채굴 난이도가 상승하게 되어있다.
* 일정량을 지속적으로 보상하는 것이 아니라 반감기로 인하여 블록 생성의 대가로 받을 수 있는 비트코인이 갈수록 줄어들어 총 공급량은 약 2100만개가 되어 희소성 가치가 부각될 것이다.

## 거래 수수료

* transaction fee
* 채굴자들이 특정 거래 기록들을 블록에 포함시켜서 블록체인에 추가할 수 있도록 제공되는 인센티브
* 블록체인 네트워크와 관련하여 중요한 목적을 수행한다.
  * 트랜잭션을 확인하고 유효정을 검증하는 사용자에게 인센티브를 제공한다.
    * 네트워크에 일조하는 행동에 대한 보상
  * 스팸 공격으로부터 네트워크를 보호하는데 일조한 채굴자와 검증자에게 트랜잭션 수수료가 보상으로 지급된다.
    * 거래 수수료는 대규모 스팸 공격과 이를 실행하는데 큰 비용이 들도록 한다.
* 대부분의 트랜잭션 수수료는 합리적인 수준으로 저렴하지만 네트워크 트래픽에 따라 비싸질 수도 있다.
* 얼마의 수수료를 지급하느냐에 따라 트랜잭션이 다음 블록에 추가되는 우선 순위가 정해진다.
* 많은 수수료를 지불할 수록 확인 과정이 빨라진다. 

## TPS

* 1초당 처리할 수 있는 트랜잭션의 수
* 원장이 분산화되고 참여 노드가 증가할수록 TPS는 느려지고 수수료는 증가한다.
* 중앙화를 통해 TPS를 높일 수 있으나 그 경우 블록체인의 원래 목적인 탈중앙화라는 취지가 훼손된다.

## Mining pool

* 채굴 풀
  * pool : 일종의 조합
* 등장 배경
  * 비트코인은 알고리즘을 해결하고 거래 장부에 블록을 생성하게 되면 보상으로 비트코인을 받는 방식으로 채굴된다.
    * 해시파워를 높여 먼저 블록을 생성하고 코인을 받기 위해 채굴자들이 협동하기 시작했다.
      * hash power
        * 해시 파워
        * 블록체인 네트워크에서 채굴자들이 가지고 있는 채굴 역량
* 종류
  * BTC.com에서 채굴 풀의 해시레이트를 확인할 수 있다.
    * hash rate
      * 해시 레이트
      * 연산 처리 능력을 측정하는 단위
      * 해시 속도
  * mining pool hub 등
* 위험성
  * 51% 공격
    * 블록체인의 전체 노드 중 50%를 초과하는 해시 파워를 확보한 뒤 거래 정보를 조작함으로써 이익을 얻으려는 해킹 공격
    * 특정 채굴 풀이 비트코인 네트워크 해시율을 51%이상 생성해 네트워크의 51%이상을 통제하는 경우 채굴 중앙 집중화가 발생할 수 있다.
    * 이 경우 이중 지불 공격을 성공할 수 있고, 합의에 영향을 미치며 비트코인 네트워크에 다른 버전의 거래 내역을 강요할 수 있다.
  * 지 해시 (GHash.IO)의 사례
* 새로운 채굴 풀 모델
  * 커스터디 서비스 형태
    * custody
      * 커스터디
      * 보호, 관리
      * 금융 거래에 있어 수탁 업무를 의미한다.
        * 수탁 업무
          * 다른 사람의 자산 관리를 위탁받는 것
    * 남의 코인을 위임받아 운용하는 서비스
    * 자산 운용
    * 전통의 지분 증명 PoS 서비스를 이용하려면 특정 노드가 자산으로 스테이킹해서 운영하게 된다. 
      * staking
        * 스테이킹
        * 자신이 보유하고 있는 가상화폐 중 일정 지분량을 고정하는 것
        * 가상화폐 보유자는 가격의 등락과 상관없이 가상화폐를 예치하고, 예치 기간 일정 수준의 이익을 얻을 수 있다.
    * 그 자산이 어느 정도 이상 있어야 많은 돈을 받을 수 있는 구조라 돈이 적은 사람은 상대적으로 취약할 수 밖에 없다.
    * 채굴 풀을 이용해서 돈이 적은 사람도 PoS 채굴 풀에 합류해서 파이를 나눠 이익을 얻는다.
    * 노드는 채굴 풀이 돌아가니 보상에서 일정 수수료를 제외하고 자신이 받아가는 형태의 새로운 채굴 풀이 등장한다.
    * 여기서 성장한 방식이 DPoS 위임지분 증명 방식을 사용하는 채굴풀이다.
      * 사용자가 시스템에 스테이킹을 해두고 투표를 통해 채굴자(노드)를 선정하는 시스템 