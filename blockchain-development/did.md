# DID

* DID(Decentralized Identity, 탈중앙 신원증명)
* 데이터의 주권이 개개인에게 있고, 필요한 때 그 데이터를 중앙화된 시스템을 거치지 않고 증명할 수 있는 기술
* 분산원장기술(Distributed Ledger Technology, DLT)을 기반으로 사용자 정보를 저장하여 안전하고 편리한 인증이 가능
* 중앙화된 레지스트리(데이터 저장소), 데이터제공자(Provider), 인증기관(Certificate Authorities)들을 분리할 수 있다.
* 중앙화된 방식이 탈중앙화 방식으로 동작할 수 있도록 설계되었다.
* 기존의 중앙화된 인증방식에서 벗어나 탈중앙화 방식의 신원 증명을 통해 자기 자신이 신원증명에 대한 권한을 갖도록 하겠다는 SSI(이후 설명)개념을 현실화하기 위해 사용

## 데이터 주권과 DID (W3C와 DID)

* W3C의 탈중앙 운동
  * DID 표준 등장의 기술적 맥락을 이해하기 위해서는 W3C(World Wide Web Consortium)내의 탈중앙 운동에 대한 이해가 필요
  * W3C 활동의 본질적인 목적은 웹에서 상호 공유하고 이를 통해 자유롭게 데이터를 사용자들끼리 주고받게 하기 위한 것
  * 데이터의 주권 특정기업(페이스북, 구글 등)에 종속되는 웹 생태계에 대해 W3C 내에서 문제제기가 이어졌고, 이를 바로 잡고자 W3C 참여자와 팀버너스리는 탈중앙 운동을 전개
    * W3C(World Wide Web Consortium, 축약형은 WWW 또는 W3)
      * 월드 와이드 웹을 위한 표준을 개발하고 장려하는 조직으로 팀 버너스 리를 중심으로 1994년 10월에 설립
* W3C의 데이터 탈중앙화를 위한 표준화
  * 데이터 탈중앙 운동에서 가장 중요한 부분은 데이터의 연동
  * 각 글로벌 기업이 독점적으로 데이터를 보유하게 된 것은 타 서비스와의 연동이 불가능하기 때문
  * 탈중앙 생태계를 만들어가기 위해서는 서비스 간의 데이터 연동이 가장 중요한 사항으로 대두된다.
  * 데이터 연동을 위해 선행되어야 할 부분은 해당 데이터가 어떤 종류의 데이터 인가를 결정하는 것
  * 이에 따라 데이터 연동을 위한 표준화를 진행
* W3C와 DID
  * DID에서 난제(해결하기 어려운 문제)
    * 중앙화되지 않은 저장소에 개인의 신원을 증명할 수 있는 데이터를 보관하면서, 데이터의 무결성과 보안성을 확보하는 것
    * 블록체인 기술이 등장하면서 탈중앙화된 방식으로 신원데이터를 저장하고 증명할 수 있는 방법을 모색
  * W3C에서도 2016년도에 블록체인 워크샵에서 블록체인 기반의 ID를 표준화하자는 의견이 개진되고, 2019년 DID 워킹그룹이 공식적으로 결성

## W3C 표준화 - DIDs(탈중앙화 식별자)

* Decentralized identifiers
* DIDs(탈중앙화 식별자)
* DID(Decentralized Identity)를 실현할 수 있는 기술에 대한 표준화
* 검증가능하고 탈중앙화된 디지털 신원을 위한 새로운 형식의 식별자
* 누구나 DID 메소드(DID Method)로 자신의 주소를 만들 수 있고, DIDs는 주소이면서 마스터키를 활용하여 만들 수 있다.
  * ID, Password로 생각
* Identity(식별자)
  * 개인 혹은 단체(법인)등을 구별할 수 있는 고유 값
  * 이메일 계정 등
* DID 문서 (DID Document)
  * 특정 DID를 어떻게 사용하는지에 대해 설명해 놓은 간단한 문서
  * DID 문서는 암호학적 요소, 검증 메소드, 서비스 엔드포인트 등으로 표현될 수 있다.
  * DID 식별자와 주체가 상호 작용을 하기 위한 서비스 엔드포인트들을 포함
  * DID 인증정보가 들어간다.
  * ID의 제어권과 소유권등을 증명할 수 있는 공개키와 인증정보가 들어가 있다.
* DID 메소드(DID Method)
  * 특정 분산 원장 또는 네트워크에서 DID와 관련된 DID 문서들을 생성, 읽기, 갱신, 그리고 비활성화 하는 메커니즘

![](did-example.png)

* DID 형식
  * did: 문자열이 did임을 나타내며, 이 주소가 did스키마에 따른 것임을 나타낸다. 항상 did로 시작한다.
  * example : did 메소드의 이름이고, did는 메소드별로 다르게 처리된다.
  * 123456789abcdefghi : DID 메소드 안에서 사용되는 고유 아이디
  * did 아이디가 주는 가장 중요한 정보는 "DID문서가 어디에 있는지"이다.
  * ID와 관련된 정보는 did문서에 담겨 있다.
* DID 문서 내용
  * DID 문서 내용의 핵심적인 정보는 id의 제어권, 소유권 등이 증명할 수 있는 공개키와 인증정보
  * id : 이 did문서를 설명하고 있는 아이디
  * 공개키 : 이 아이디와 관련된 공개키 리스트
  * 인증정보 : 이 아이디의 소유권을 증명하기 위한 정보
  * 서비스 : 이 아이디와 상호작용이 가능한 서비스들의 리스트
  * 어떤 개인정보도 저장되지 않는다.
* DID Registry
  * DID메소드가 다르고, DID 사용하는 블록체인 플랫폼이 모두 다른 상황에서 DID Document를 가져온다면 굉장히 복잡해진다.
* DIF(Decentralized Identity Foundation) 글로벌 조직
  * 전 세계의 사용자들이 DID를 보다 쉽게 사용할 수 있도록 지원하기 위해 만든 조직
  * Sovrin, uport, Civic, MS, IBM, Master Card 등
  * DID 소유자가 Agent일 때, DID로 Universal Resolver에서 DID Document를 뽑아낼 수 있다.
  * 사용자 편의성과 DID 표준을 만들며 활용한 소프트웨어를 만드는 중요한 역할을 하고 있다.
  * DIF 유니버셜 리졸버(DIF Universal Resolver)
    * DID 드라이버 컬렉션을 사용하여 구현 및 분산 된 시스템에서 DID에 대한 조회 및 해결의 표준 방법을 제공하고 있다.
    * DID와 연결된 DPKI 메타데이터를 캡슐화 하는 DID Document Object(DDO)를 반환하는 서버
* DID 인증(Authentication)
  * DID 인증절차
    * 회사(company)에서 DID소유권자에게 DID의 유무를 확인하기 위해 소유권자에게 challenge 신청한다.
    * 소유자인 나는 회사에게 response를 준다.
    * 회사는 응답받은 DID로 Universal Resolver에서 DID document를 가져온다.
    * DID document안에 기록되어 있는 인증정보로 소유자에게 받았던 response를 검사하여 확인한다.
    * response 검사를 통해 응답한 소유자가 DID를 가지고 있는 것인지 확인한다.
  
  ![](did-authentication.png)

    * 누군가의 신원을 검증하고자 할 때, DID의 소유자의 소유권을 Universal Resolver를 통해서 DID document에서 인증정보를 확인한다.
    * 소유자가 제시한 DID와 Universal Resolver의 DID document 안에 기록되어 있는 정보를 서로 확인한다.
    * 소유자가 제시한 정보의 진위여부를 확인하는 절차를 거친다.

## DID 사용사례

### DID 주요 서비스 모델

* 인증
  * DID 기술 중 가장 대표적인 서비스 
  * 블록체인 기반으로 사용자 인증을 진행
  * 기존의 방식
    * 아이디, 패스워드 기반의 인증방식
    * 특정 서비스 제공자가 사용자의 정보를 서버에 보관하며, 다른 사업체에 넘겨 불합리한 수익 창출이 가능하고, 사용자의 정보가 유출될 가능성이 있다.
  * DID는 특정 서비스 제공자에게 사용자의 정보를 독점적으로 주어지지 않도록 할 수 있다.
  * 대규모의 정보 유출을 막을 수 있고, 사용자 자신의 정보를 자신이 원하는 장소에 개별적으로 보관이 가능하다.
* 전자증명서
  * 기존의 증명서
    * 사용자가 필요한 만큼의 문서를 비용으로 지불하고, 문서형태로 발급받아 사용
    * 위변조가 발생할 수 있는 위험성
  * DID 기반의 전자증명서를 발급하면, 문서로 발급해야하는 번거로움과 위변조를 막을 수 있다.
  * 졸업 증명서 발급 시나리오
    1. 사용자(Holder)는 자신의 졸업증명서(Verifiable Credential)를 발급 받고자하는 출신학교(Issuer)에게 요구한다.
    2. 출신학교(Issuer)는 블록체인 저장소에 자신의 DID를 발급하여 공개키와 함께 저장하고, 사용자(Holder)에게 개인키가 담긴 졸업증명서(Verifiable Credential)를 제공한다.
    3. 사용자(Holder)는 자신의 DID를 블록체인에 저장하고, 전달받은 졸업 증명서에 자신의 개인 키를 담아 증명서를 요구하는 기관(Verifier)에 졸업증명서(Verifiable Credential)를 제출한다.
    4. 증명서를 요구하는 기관(Verifier)은 졸업증명서(Verifiable Credential) 내의 개인키와 블록체인 내의 공개키를 활용하여 제출받은 졸업증명서(Verifiable Credential)의 진위여부를 판가름할 수 있다.
* 출입통제
  * 기존 출입통제는 기업은 출입자(직원 등)의 개인정보를 기업 서버에 저장할 수 밖에 없었고, 별도의 중앙 서버가 필요해 상당한 비용이 드는 형태
  * DID 사용 출입통제 시스템
    * 기업의 직원은 자신의 DID를 발급하여 블록체인에 저장하고 출입시 자신의 DID번호가 담긴 스마트폰을 통해 출입한다.
    * 기업은 DID기반의 출입통제로 DID를 받아 블록체인 검증을 통해 DID의 유효성 여부만을 체크하면 되기 때문에, 안전하게 출입통제가 가능하다.

### 국내 DID 시장 동향

* 국내에서는 다양한 방식의 신원 모델이 혼용되고 있는 상황
* 공인인증서를 대체하기 위한 DID 컨소시엄이 출범

### DID 얼라이언스 동향

* DID 서비스 자체가 별도의 기업이 서비스하기 보다는 다양한 기업, 비영리 기관들과의 협업이 중시하는 국내외에서 다양한 얼라이언스가 설립되어 활동
* 이니셜 DID 어소시에이션
  * '2019 블록체인 민간주도 국민프로젝트'를 수행하는 기업들 중심으로 결성
  * SK텔레콤, LG유플러스, KT 등의 통신사와 , 코스콤, KEB하나은행, 삼성전자등이 참여하여 2019년 7월 결성
  * 모바일 전자증명과 관련한 서비스
  * SK텔레콤 중심이 되어 개발한 하이퍼레저를 기반
  * 기존 증명서 발급 및 제출, 구매확인서 등의 전자증명서 서비스를 목표로 진행
  * 이동통신 3사와 블록체인 기술이 결합한 PASS
    * 편의점에서 담배,술 등을 살 때, 19세이상을 확인이 가능
    * 신분증의 주소, 나이, 사진 등을 노출하지 않고 19세이상인지만 확인
    * 개인이 자신의 신원정보를 주권을 가지게 되고, 근본적으로 데이터의 대한 자기 주권을 확립할 수 있다.
    * 유출에 대한 위험성이 거의 없다.
    * 자신이 신원정보가 필요할 때 쉽게 인증하여 사용이 가능
    * 불필요한 신원정보의 유출없이 신원인증이 가능
* DID 얼라이언스 코리아
  * '금융결제원'과 '한국전자서명포럼, ' 한국 FIDO 산업포럼'이 주축이 되어 2019년 10월 결성
  * 라온시규어, BC카드, 삼성SDS 등이 함께 참여
  * 주요목적은 DID 신원인증 이프라 구축에 필요한 글로벌 표준화와 이를 시장에 확산시키는 것
  * 라온시큐어가 개발한 DID 옴니원을 기반
  * DID로 공무원증 보급, 국가신분증으로 인정되는 정부의 '모바일 운전면허증' 서비스
* 마이아이디 얼라이언스
  * 아이콘루프가 주도하여 2019년 9월 설립된 연합체
  * 신한은행, 부산은행 등 은행과 삼성증권, KB증권 등 증권사 등이 대거 참여
  * 금융권의 계좌 개설, 금융 거래를 DID 방식으로 서비스하기 위한 목적
  * 아이콘 루프에서 개발한 분산 ID를 기반
* 마이키핀 얼라이언스
  * ㈜코인플러그(Coinplug)가 출범한 디지털 ID 연구와 관련된 서비스를 개발하기 위한 국내·외 기업 연합
  * 마이키핀 서비스를 토대로 게임, 미디어, 정부, 교육, 자율주행, 사물인터넷(IoT) 등 광범위한 산업 등에 적용
  * 코인플러그의 메타디움 퍼블릭 블록체인 기술 기반

### 국내 DID 시장 한계

* 블로코 보고서에 따르면, 신원정보의 속성을 3가지로 구분
  * 태생적 속성(Inherent Attributes, 나이, 생일, 지문 등)
  * 축적된 속성(Accumulated Attributes, 건강기록, 신용정보 등)
  * 부여된 속성(Assigned Attributes, 주민/여권번호 등)
* "태생적 속성과 부여된 속성에만 집중하여 DID 서비스 구축 사례 대부분이 일반 사용자들이 활용하는 VC 중 극히 일부분만 활용하는데 머물고 있다"고 분석
* 현재 상황에서 "'공인인증서 대체'가 DID의 가장 큰 목표가 돼 버렸고, 현행 공인인증서를 기준으로 쓰여진 금융실명법 등의 현행법과 계속 충돌되고 있다"
* SSI의 핵심가치는 데이터의 주권을 특정 기관이나 기업에서 개인에게 이동하는데 있다.
  * SSI 가치를 실현하기 위한 수단인 DID는 검증되는 데이터 종류로 한정된 개인 정보만을 가지고 '로그인 방식 중 하나'로 불편함과 보안 책임을 떠넘기는 방식으로 진행되는 것을 우려

## DID를 활용한 졸업증명서 개발하기

* 검증 가능한 크리덴셜과 크리덴셜이 저장될 공간을 고려
[vc-data-model 페이지](https://ssimeetupkorea.github.io/vc-data-model/)
* 크리덴셜 (Credential)
  * Issuer가 제기한 하나 이상의 Claim 집합.
  * Verifiable Credential(검증가능한 크레덴셜, 이하 VC)
    * 암호화된 검증을 생성할 수 있는 변조 방지 Credential
    * VC를 사용하여 암호화된 Verifiable Presentation(검증가능한 프레젠테이션, 이하 VP)을 만들 수도 있다.
* code/CredentialBox.sol